$.tools.validator.addEffect("depageEffect",function(a,b){$.each(a,function(a,b){var c=$(b.input).parents("p");$errorMessage=c.find(".errorMessage");0===$errorMessage.length?(c.append('<span class="errorMessage">'+c.attr("data-errorMessage")+"</span>"),c.addClass("error")):$errorMessage.show()})},function(a){$.each(a,function(a,d){var e=$(d).parents("p");e.removeClass("error");e.find(".errorMessage").remove()})});
function setupForm(a){var b=$(a),d=b.attr("data-jsvalidation"),e=b.attr("data-jsautosave");"blur"==d||"change"==d?b.validator({effect:"depageEffect",inputEvent:d,errorInputEvent:d}):"submit"==d&&b.validator({effect:"depageEffect",errorInputEvent:null});b.bind("onFail",function(a,f){b.find(".submit").addClass("error")});b.bind("onSuccess",function(a,f){0<b.find(".errorMessage").length?b.find(".submit").addClass("error"):b.find(".submit").removeClass("error")});b.delegate(".error input","focus",function(a){$(this).parents(".error").find(".errorMessage").hide()});
if("true"==e){var c=new Date;a.data=a.data||{};a.data.saving=!1;a.data.lastsave=c.getTime();a.data.timer=null;a.data.autosave=function(){var b={};$("input, select, textarea",a).each(function(){var a=$(this).attr("type");"radio"==a?this.checked&&(b[this.name]=this.value):"checkbox"==a?this.checked&&(b[this.name]=b[this.name]||[],b[this.name].push(this.value)):b[this.name]=$(this).val()});b.formAutosave="true";a.data.saving=!0;$.post(a.action,b,function(b,d){c=new Date;a.data.lastsave=c.getTime();a.data.saving=
!1})};a.data.changed=function(b){c=new Date;clearTimeout(a.data.timer);a.data.saving||(b||1E3<c.getTime()-a.data.lastsave?a.data.autosave():setTimeout(function(){a.data.changed()},1E3))};$("input, select, textarea",a).change(function(){a.data.changed(!0)});$("textarea",a).keyup(function(){a.data.changed()})}$("input:checkbox, input:radio",a).each(function(){$(this).parents("label").bind("click",function(a){})});$(".input-textarea",a).each(function(){var a=$.parseJSON($(this).attr("data-textarea-options")),
b=$("textarea",this),c=$('<textarea class="textarea-size"></textarea>').appendTo(b.parent()).height("auto").css({position:"absolute",left:"-10000px"});a.autogrow&&!$.browser.msie&&(b.autogrow=function(){c[0].value=b[0].value;b.height(c[0].scrollHeight+30)},b.mouseup(function(){}).keyup(function(){b.autogrow()}).keydown(function(){b.autogrow()}).scroll(function(){b.autogrow()}).autogrow())});$(".input-richtext",a).each(function(){var a=$.parseJSON($(this).attr("data-textarea-options"))||$.parseJSON($(this).attr("data-richtext-options"));
$("textarea",this).depageEditor(a)});$("input[autofocus]:first",a).focus();$("input[type='url']",a).change(function(){""===this.value||this.value.match(/[a-z][\w\-]+:\/\/.*/)||(this.value="http://"+this.value)})}$(document).ready(function(){$(".depage-form").each(function(){setupForm(this)})});
